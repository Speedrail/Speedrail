openapi: 3.1.0
info:
  title: Speedrail Web Support API (Reference)
  version: 0.1.0
  description: >-
    Reference contracts derived from feature requirements. Intended as a client
    integration guide and a future backend API target. MVP may call provider
    APIs directly (e.g., Google, Transiter/MTA) without this server.
servers:
  - url: https://api.example.com
    description: Placeholder server (non-binding for MVP)
paths:
  /routes:
    get:
      summary: List routes
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Route'
  /routes/{id}:
    get:
      summary: Get route by id
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Route'
  /routes/{id}/stops:
    get:
      summary: List stops for route
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Stop'
  /stops/{id}/arrivals:
    get:
      summary: Get upcoming arrivals for a stop
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Arrival'
  /alerts:
    get:
      summary: List service alerts
      parameters:
        - in: query
          name: routes
          schema:
            type: array
            items: { type: string }
            description: Filter by route ids
          style: form
          explode: true
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ServiceAlert'
  /subscriptions:
    post:
      summary: Subscribe to route alerts (in-app)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SubscriptionRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Subscription'
  /subscriptions/{id}:
    delete:
      summary: Unsubscribe from route alerts
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '204': { description: No Content }
components:
  schemas:
    Route:
      type: object
      properties:
        id: { type: string }
        shortName: { type: string }
        longName: { type: string }
        color: { type: string, pattern: '^#?[0-9a-fA-F]{6}$' }
        textColor: { type: string, pattern: '^#?[0-9a-fA-F]{6}$' }
        type: { type: string, enum: [subway, bus, rail, ferry, sir] }
    Stop:
      type: object
      properties:
        id: { type: string }
        name: { type: string }
        latitude: { type: number, minimum: -90, maximum: 90 }
        longitude: { type: number, minimum: -180, maximum: 180 }
        routes:
          type: array
          items: { type: string }
    Arrival:
      type: object
      properties:
        routeId: { type: string }
        routeShortName: { type: string }
        headsign: { type: string }
        arrivalTime: { type: integer, description: Epoch seconds }
        departureTime: { type: integer, nullable: true }
        tripId: { type: string }
        vehicleId: { type: string, nullable: true }
        delay: { type: integer, nullable: true }
        track: { type: string, nullable: true }
    ServiceAlert:
      type: object
      properties:
        id: { type: string }
        title: { type: string }
        description: { type: string }
        severity: { type: string, enum: [info, warning, critical] }
        affectedRoutes:
          type: array
          items: { type: string }
        publishedAt: { type: string, format: date-time }
        expiresAt: { type: string, format: date-time, nullable: true }
    SubscriptionRequest:
      type: object
      required: [routes]
      properties:
        routes:
          type: array
          items: { type: string }
        channel:
          type: string
          enum: [in_app]
          default: in_app
    Subscription:
      type: object
      properties:
        id: { type: string }
        routes:
          type: array
          items: { type: string }
        channel: { type: string, enum: [in_app] }
